# Modelfile: gemma3-4b-100k.modelfile

# This tells Ollama to use your existing gemma3:12b-it-qat model as the base
FROM gemma3:12b-it-qat

# Set the desired context window size (number of tokens)
PARAMETER num_ctx 100000

# You can also include other parameters you saw from `ollama show --modelfile gemma3:12b-it-qat`
# if you want to ensure they are preserved or if you want to change them.
# It's often good to copy relevant ones. For example:
PARAMETER top_k 64
PARAMETER top_p 0.95
PARAMETER temperature 1 
# Note: The stop parameter is often critical and tied to the template.
# The template itself is also critical for instruction following.
# It's generally best to let Ollama inherit these from the base model if possible,
# unless you specifically want to override them.
# If `ollama show --modelfile` for the base model showed a TEMPLATE, it will likely be inherited.
# If it did not show a specific stop sequence, you might not need to set it here either if it's inherited.
# However, Gemma models often use <end_of_turn> or <eos> as stop tokens.
# Let's try inheriting the template and stop sequence first by not specifying them here,
# as they are usually part of the base model's configuration.
# If you find issues with stopping, you might need to explicitly add:
# TEMPLATE """{{- range $i, $_ := .Messages }} ... (copy from `ollama show --modelfile gemma3:12b-it-qat`) ... {{- end }}"""
# PARAMETER stop <end_of_turn> 
# PARAMETER stop <eos> # Gemma might use this too. Check model card or experiment.

# Optional: You might want to adjust other parameters like mirostat, num_gpu, etc.
# For example, to try and ensure it uses GPU if available:
# PARAMETER num_gpu -1 # Use all available GPUs